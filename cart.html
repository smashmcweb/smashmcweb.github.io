<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MediaMC Carrello</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:'Segoe UI',Arial;background:linear-gradient(135deg,#0ea5e9,#020617);color:#fff}
header{text-align:center;padding:40px 20px;background:rgba(2,6,23,.9)}
header h1{color:#38bdf8;margin:0}
#nickBar{background:rgba(2,6,23,.9);padding:10px 20px;text-align:right;border-bottom:2px solid #38bdf8;margin-bottom:10px}
section{max-width:500px;margin:30px auto;background:rgba(2,6,23,.85);padding:20px;border-radius:12px;border:2px solid #38bdf8}
button{padding:6px 12px;border-radius:6px;border:none;cursor:pointer;margin:5px}
button.green{background:#22c55e;color:#fff}
button.red{background:#ef4444;color:#fff}
.productItem{display:flex;justify-content:space-between;background:rgba(2,6,23,.8);padding:8px;border-radius:6px;margin:5px 0;align-items:center}
</style>
</head>
<body>

<div id="nickBar"></div>

<header>
<h1>üõí Carrello MediaMC</h1>
</header>

<section>
  <h2>Prodotti</h2>
  <div id="cartList"></div>
  <h3>Totale: ‚Ç¨<span id="total">0</span></h3>
  <button class="green" onclick="checkout()">Procedi Ordine</button>
  <button class="red" onclick="clearCart()">Svuota Carrello</button>
  <button onclick="window.history.back()">‚Üê Continua Acquisti</button>
</section>

<script>
const nick=sessionStorage.getItem('nick');
if(!nick){ alert("Inserisci il nick nello store!"); window.location='store.html'; }
document.getElementById('nickBar').textContent=`Loggato come: ${nick}`;

let cart=JSON.parse(localStorage.getItem('cart_'+nick))||[];

function render(){
  const cartDiv=document.getElementById('cartList');
  cartDiv.innerHTML='';
  let tot=0;
  if(cart.length===0){cartDiv.textContent='Carrello vuoto';document.getElementById('total').textContent='0'; return;}
  cart.forEach((p,i)=>{
    tot+=p.price;
    const div=document.createElement('div');
    div.className='productItem';
    div.innerHTML=`<span>${p.name} - ‚Ç¨${p.price}</span><button onclick="remove(${i})">X</button>`;
    cartDiv.appendChild(div);
  });
  document.getElementById('total').textContent=tot;
}

function remove(idx){ cart.splice(idx,1); localStorage.setItem('cart_'+nick,JSON.stringify(cart)); render(); }

function clearCart(){ if(!confirm('Svuotare il carrello?')) return; cart=[]; localStorage.setItem('cart_'+nick,JSON.stringify(cart)); render(); }

function checkout(){
  if(cart.length===0){ alert('Carrello vuoto!'); return; }
  const tot=cart.reduce((s,p)=>s+p.price,0);
  const id='MM-'+Math.floor(Math.random()*100000);
  const checkoutData={id,nick,cart,total:tot};
  let allOrders=JSON.parse(localStorage.getItem('checkoutDataList'))||[];
  allOrders.push(checkoutData);
  localStorage.setItem('checkoutDataList',JSON.stringify(allOrders));
  localStorage.removeItem('cart_'+nick);
  alert(`Ordine creato! ID: ${id}\nVai a Checkout per dettagli pagamento.`);
  window.location='checkout.html';
}

render();
</script>

</body>
</html>
