<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MediaMC Carrello</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#0ea5e9,#020617);color:#fff;}
header{text-align:center;padding:40px 20px;background:rgba(2,6,23,0.9);}
header h1{color:#38bdf8;margin:0;font-size:2.5em;}
header p{color:#bae6fd;margin:5px 0 0;}
section{max-width:600px;margin:30px auto;background:rgba(2,6,23,0.8);padding:20px;border-radius:12px;border:2px solid #38bdf8;}
.productItem{display:flex;justify-content:space-between;align-items:center;background:rgba(0,10,30,0.7);padding:10px;margin:5px 0;border-radius:6px;}
button{padding:5px 10px;border:none;border-radius:6px;margin-left:5px;cursor:pointer;}
button.delete{background:#ef4444;color:#fff;}
button.green{background:#22c55e;color:#fff;}
input{padding:6px;border-radius:6px;border:none;width:80%;}
</style>
</head>
<body>

<header>
<h1>üõí Carrello MediaMC</h1>
<p>Controlla i tuoi prodotti prima di procedere</p>
</header>

<section>
<h2>Prodotti</h2>
<div id="cartList"></div>
<h3>Totale: ‚Ç¨<span id="total">0</span></h3>

<h3>GiftCard</h3>
<input id="giftInput" placeholder="Inserisci Gift Card">
<button onclick="applyGift()">Applica</button>
<p id="giftMsg"></p>

<button class="green" id="checkoutBtn" onclick="checkout()">Procedi Ordine</button>
<button onclick="clearCart()" style="background:#ef4444;color:#fff;">üóëÔ∏è Svuota Carrello</button>
<br><br>
<button onclick="window.location.href='store.html'" style="background:#38bdf8;color:#fff;">‚Üê Torna allo Store</button>
</section>

<script>
let cart = JSON.parse(localStorage.getItem('cart'))||[];
let giftValue = 0;
let giftCards = JSON.parse(localStorage.getItem('giftCards'))||[];

function render(){
  const cartList=document.getElementById('cartList');
  let total=0;
  cartList.innerHTML='';
  if(cart.length===0){
    cartList.textContent='Carrello vuoto';
    document.getElementById('checkoutBtn').disabled=true;
  } else {
    document.getElementById('checkoutBtn').disabled=false;
    cart.forEach((p,idx)=>{
      total+=p.price;
      const div=document.createElement('div');
      div.className='productItem';
      div.innerHTML=`<span>${p.name} - ‚Ç¨${p.price}</span><button class="delete" onclick="removeItem(${idx})">X</button>`;
      cartList.appendChild(div);
    });
  }
  total = Math.max(0, total - giftValue);
  document.getElementById('total').textContent = total;
}
render();

function removeItem(idx){
  if(confirm('Rimuovere questo prodotto dal carrello?')){
    cart.splice(idx,1);
    localStorage.setItem('cart',JSON.stringify(cart));
    render();
  }
}

// Gift Card
function applyGift(){
  const code = document.getElementById('giftInput').value.trim().toUpperCase();
  const gc = giftCards.find(g=>g.code===code);
  const msg = document.getElementById('giftMsg');
  if(!gc){ msg.textContent='Gift card non valida'; return; }
  if(gc.used){ msg.textContent='Gift card gi√† utilizzata'; return; }
  giftValue = gc.value;
  gc.used = true;
  localStorage.setItem('giftCards',JSON.stringify(giftCards));
  msg.textContent=`Gift card applicata: -‚Ç¨${giftValue}`;
  render();
}

// Checkout
function checkout(){
  if(cart.length===0) return alert('Carrello vuoto!');
  const nick = prompt('Inserisci il tuo Nick Minecraft:','')?.trim();
  if(!nick) return alert('Nick obbligatorio!');
  const tot = cart.reduce((s,p)=>s+p.price,0)-giftValue;
  const id = 'MM-'+Math.floor(Math.random()*100000);
  const checkoutData = {id, cart, total: tot, nick};
  // Salviamo in lista globale ordini
  let checkoutDataList = JSON.parse(localStorage.getItem('checkoutDataList'))||[];
  checkoutDataList.push(checkoutData);
  localStorage.setItem('checkoutDataList',JSON.stringify(checkoutDataList));
  localStorage.setItem('checkoutData',JSON.stringify(checkoutData));
  alert('Ordine creato! ID: '+id);
  window.location.href='checkout.html';
}

// Svuota carrello
function clearCart(){
  if(confirm('Vuoi svuotare il carrello?')){
    cart=[];
    localStorage.removeItem('cart');
    render();
  }
}
</script>

</body>
</html>
